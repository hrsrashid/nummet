module SodeRungeKuttaSpec where

import qualified Data.Matrix    as Mx
import qualified Data.Vector    as Vec
import           Function
import           Library
import qualified SodeRungeKutta
import           Test.Hspec
import           TestLib


suite :: SpecWith ()
suite =
  describe "SodeRungeKutta" $ do
    let compute = toCReal3 . fmap Mx.toLists . SodeRungeKutta.compute . fmap Mx.fromLists

    it "solve y' = {1, 2x}; y(0) = {0, 0}" $
      compute (0.1,
        [ [simpleFunc "1"  (Right . const 1), simpleFunc "0" (Right . const 0)]
        , [simpleFunc "2x" (Right . (2*)),    simpleFunc "0" (Right . const 0)]
        ]) `shouldBe` Right (toCReal [[0.0,0.0,0.0],[0.1,0.1,1e-2],[0.2,0.2,4.0e-2],[0.3,0.3,9.0e-2],[0.4,0.4,0.16],[0.5,0.5,0.25],[0.6,0.6,0.36],[0.7,0.7,0.49],[0.8,0.8,0.64],[0.9,0.9,0.81],[1,1,1],[1.1,1.1,1.21],[1.2,1.2,1.44],[1.3,1.3,1.69],[1.4,1.4,1.96],[1.5,1.5,2.25],[1.6,1.6,2.56],[1.7,1.7,2.89],[1.8,1.8,3.24],[1.9,1.9,3.6100000000000003],[2.000000000000001,2.0000000000000004,4.0],[2.100000000000001,2.1000000000000005,4.41],[2.200000000000001,2.2000000000000006,4.840000000000001],[2.300000000000001,2.3000000000000007,5.290000000000001],[2.4000000000000012,2.400000000000001,5.760000000000002],[2.5000000000000013,2.500000000000001,6.250000000000002],[2.6000000000000014,2.600000000000001,6.7600000000000025],[2.7000000000000015,2.700000000000001,7.290000000000003],[2.8000000000000016,2.800000000000001,7.840000000000003],[2.9000000000000017,2.9000000000000012,8.410000000000004],[3.0000000000000018,3.0000000000000013,9.000000000000004],[3.100000000000002,3.1000000000000014,9.610000000000005],[3.200000000000002,3.2000000000000015,10.240000000000006],[3.300000000000002,3.3000000000000016,10.890000000000006],[3.400000000000002,3.4000000000000017,11.560000000000006],[3.500000000000002,3.5000000000000018,12.250000000000007],[3.6000000000000023,3.600000000000002,12.960000000000008],[3.7000000000000024,3.700000000000002,13.690000000000008],[3.8000000000000025,3.800000000000002,14.440000000000008],[3.9000000000000026,3.900000000000002,15.21000000000001],[4.000000000000003,4.000000000000002,16.00000000000001],[4.100000000000003,4.100000000000001,16.81000000000001],[4.200000000000004,4.200000000000001,17.64000000000001],[4.300000000000004,4.300000000000001,18.490000000000013],[4.400000000000005,4.4,19.360000000000014],[4.500000000000005,4.5,20.250000000000014],[4.600000000000006,4.6,21.160000000000014],[4.700000000000006,4.699999999999999,22.090000000000014],[4.800000000000007,4.799999999999999,23.040000000000017],[4.9000000000000075,4.899999999999999,24.01000000000002],[5.000000000000008,4.999999999999998,25.00000000000002],[5.1000000000000085,5.099999999999998,26.010000000000023],[5.200000000000009,5.1999999999999975,27.040000000000024],[5.30000000000001,5.299999999999997,28.090000000000025],[5.40000000000001,5.399999999999997,29.160000000000025],[5.500000000000011,5.4999999999999964,30.25000000000003],[5.600000000000011,5.599999999999996,31.36000000000003],[5.700000000000012,5.699999999999996,32.49000000000003],[5.800000000000012,5.799999999999995,33.64000000000003],[5.900000000000013,5.899999999999995,34.81000000000003],[6.000000000000013,5.999999999999995,36.000000000000036],[6.100000000000014,6.099999999999994,37.210000000000036],[6.200000000000014,6.199999999999994,38.44000000000004],[6.300000000000015,6.299999999999994,39.69000000000004],[6.4000000000000155,6.399999999999993,40.96000000000004],[6.500000000000016,6.499999999999993,42.25000000000005],[6.6000000000000165,6.5999999999999925,43.56000000000005],[6.700000000000017,6.699999999999992,44.89000000000006],[6.800000000000018,6.799999999999992,46.24000000000006],[6.900000000000018,6.8999999999999915,47.61000000000006],[7.000000000000019,6.999999999999991,49.000000000000064],[7.100000000000019,7.099999999999991,50.41000000000007],[7.20000000000002,7.19999999999999,51.840000000000074],[7.30000000000002,7.29999999999999,53.29000000000008],[7.400000000000021,7.39999999999999,54.76000000000008],[7.500000000000021,7.499999999999989,56.250000000000085],[7.600000000000022,7.599999999999989,57.76000000000009],[7.700000000000022,7.699999999999989,59.29000000000009],[7.800000000000023,7.799999999999988,60.840000000000096],[7.9000000000000234,7.899999999999988,62.4100000000001],[8.000000000000025,7.999999999999988,64.00000000000011],[8.100000000000026,8.099999999999987,65.61000000000011],[8.200000000000028,8.199999999999987,67.24000000000012],[8.30000000000003,8.299999999999986,68.89000000000013],[8.40000000000003,8.399999999999986,70.56000000000013],[8.500000000000032,8.499999999999986,72.25000000000014],[8.600000000000033,8.599999999999985,73.96000000000015],[8.700000000000035,8.699999999999985,75.69000000000015],[8.800000000000036,8.799999999999985,77.44000000000017],[8.900000000000038,8.899999999999984,79.21000000000018],[9.000000000000039,8.999999999999984,81.00000000000018],[9.10000000000004,9.099999999999984,82.81000000000019],[9.200000000000042,9.199999999999983,84.6400000000002],[9.300000000000043,9.299999999999983,86.49000000000021],[9.400000000000045,9.399999999999983,88.36000000000021],[9.500000000000046,9.499999999999982,90.25000000000023],[9.600000000000048,9.599999999999982,92.16000000000024],[9.700000000000049,9.699999999999982,94.09000000000024],[9.80000000000005,9.799999999999981,96.04000000000025],[9.900000000000052,9.89999999999998,98.01000000000026],[10.000000000000053,9.99999999999998,100.00000000000027]])
