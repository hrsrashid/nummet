module BodeShootingSpec where

import qualified BodeShooting
import qualified Data.Matrix  as Mx
import qualified Data.Vector  as Vec
import           Function
import           Library
import           Test.Hspec
import           TestLib


suite :: SpecWith ()
suite =
  describe "BodeShooting" $ do
    let compute = toCReal3 . fmap Mx.toLists . BodeShooting.compute

    it "solve { uʹ = u, vʹ = v} u(0) + v(0) = 2 v(10) = 22026.46579" $
      compute (Vec.fromList [0, 10], Mx.fromLists
        [ [ simpleFunc "1" (Right . const 1)
          , simpleFunc "0" (Right . const 0)
          , simpleFunc "0" (Right . const 0)
          ]
        , [ simpleFunc "0" (Right . const 0)
          , simpleFunc "1" (Right . const 1)
          , simpleFunc "0" (Right . const 0)
          ]
        ], Mx.fromLists
        [ [ 1
          , 1
          , 2
          ]
        , [ 0
          , 1
          , 22026.46579
          ]
        ]) `shouldBe` Right (toCReal [[0.0,0.9996152420854365,1.0003847579145635],[0.1,1.104741445044755,1.1055918882885785],[0.2,1.2209234203486283,1.221863301873594],[0.30000000000000004,1.3493238667219591,1.350362592453967],[0.4000000000000001,1.4912277600388852,1.4923757250937093],[0.5000000000000001,1.6480552128029746,1.6493239055160644],[0.6000000000000001,1.8213756860160875,1.8227778029128372],[0.7000000000000001,2.0129236956621126,2.0144732685191706],[0.8,2.2246161709892447,2.226328707258437],[0.9,2.4585716383049467,2.4604642763051157],[1.0,2.7171314222666836,2.719223102696537],[1.1,3.00288307684173,3.0051947323301227],[1.2000000000000002,3.3186862804229187,3.3212410450135073],[1.3000000000000003,3.667701454247396,3.6705248949140943],[1.4000000000000004,4.05342139051908,4.056541763029227],[1.5000000000000004,4.479706206755337,4.483154738441134],[1.6000000000000005,4.950821976165773,4.95463317843386],[1.7000000000000006,5.471483420659206,5.475695434365821],[1.8000000000000007,6.046901093731866,6.051556070879959],[1.9000000000000008,6.682833525422668,6.687978051000835],[2.000000000000001,7.385644851179618,7.391330409364423],[2.100000000000001,8.162368501362009,8.168651990749249],[2.200000000000001,9.020777588755246,9.027721891776377],[2.300000000000001,9.969462698506007,9.977137310728192],[2.4000000000000012,11.017917858965555,11.026399584573108],[2.5000000000000013,12.1766355538001,12.18600927421738],[2.6000000000000014,13.457211726208078,13.467571249555908],[2.7000000000000015,14.872461826080961,14.883910825967538],[2.8000000000000016,16.436549061457143,16.44920211449846],[2.9000000000000017,18.16512613775372,18.179109870206545],[3.0000000000000018,20.07549190324082,20.090946258223266],[3.100000000000002,22.186764468398312,22.203844106379748],[3.200000000000002,24.5200725316582,24.538948378234018],[3.300000000000002,27.09876682623759,27.119627782678297],[3.400000000000002,29.948653804130245,29.971708637823298],[3.500000000000002,33.09825389586461,33.12373332956771],[3.6000000000000023,36.579086930579706,36.60724595139392],[3.7000000000000024,40.42598757277901,40.457107983948845],[3.8000000000000025,44.677453932516265,44.71184717359413],[3.9000000000000026,49.37603283775256,49.414043101350444],[4.000000000000003,54.568745624522876,54.61075330084247],[4.100000000000003,60.307558706035195,60.35398418964773],[4.200000000000004,66.64990362995323,66.70121152692569],[4.300000000000004,73.65925182836997,73.7159556058407],[4.400000000000005,81.40574981232021,81.46841693705495],[4.500000000000005,89.96692116758256,90.03617878493523],[4.600000000000006,99.42844237703999,99.50498358715092],[4.700000000000006,109.88500023369203,109.96959102773296],[4.800000000000007,121.4412394249353,121.53472635081621],[4.9000000000000075,134.21280977112434,134.31612840537704],[5.000000000000008,148.32752359872092,148.44170790934254],[5.1000000000000085,163.92663483051973,164.05282752447505],[5.200000000000009,181.16625259352938,181.30571655246567],[5.30000000000001,200.21890349128222,200.3730344099],[5.40000000000001,221.2752581751154,221.44559852867448],[5.500000000000011,244.54603949319835,244.73429397394008],[5.600000000000011,270.26413131323307,270.47218389019946],[5.700000000000012,298.6869091230081,298.91684189598544],[5.800000000000012,330.09881573244445,330.35292976871324],[5.900000000000013,364.81420785363986,365.09504621605623],[6.000000000000013,403.1805020462476,403.4908752431115],[6.100000000000014,445.58165151144465,445.9246656228454],[6.200000000000014,492.4419885287316,492.82107629084794],[6.300000000000015,544.2304709890032,544.6494261474354],[6.4000000000000155,601.4653755213467,601.928390797274],[6.500000000000016,664.7194841803416,665.231193229454],[6.6000000000000165,734.6258165999742,735.1913403840849],[6.700000000000017,811.8839649790715,812.5089630144779],[6.800000000000018,897.2670952960372,897.9578222915005],[6.900000000000018,991.6296848180037,992.3930532691567],[7.000000000000019,1095.9160733380304,1096.7597227046297],[7.100000000000019,1211.1699137174132,1212.1022868757332],[7.20000000000002,1338.5446163100278,1339.5750440454979],[7.30000000000002,1479.3148917919657,1480.453686177616],[7.400000000000021,1634.8895079120875,1636.1480655072953],[7.500000000000021,1806.8253878275086,1808.2163037298126],[7.600000000000022,1996.8431911140349,1998.3803850053978],[7.700000000000022,2206.8445333795275,2208.5433888284656],[7.800000000000023,2438.9310168066077,2440.8085352202593],[7.9000000000000234,2695.4252620741026,2697.500232840923],[8.000000000000025,2978.8941521355623,2981.1873406613604],[8.100000000000026,3292.1745204684858,3294.70887598758],[8.200000000000028,3638.4015408710884,3641.202426112274],[8.30000000000003,4021.0401029193645,4024.135547925082],[8.40000000000003,4443.919487076384,4447.340469715203],[8.500000000000032,4911.27168646725,4915.052442446919],[8.600000000000033,5427.773758827389,5431.952124310919],[8.700000000000035,5998.59463246407,6003.212422717617],[8.800000000000036,6629.446834644875,6634.550262506753],[8.900000000000038,7326.643660088361,7332.283798447046],[9.000000000000039,8097.16235167432,8103.3956445837275],[9.10000000000004,8948.713925658736,8955.602753205783],[9.200000000000042,9889.820340173846,9897.433642751259],[9.300000000000043,10929.89977928213,10938.313747513934],[9.400000000000045,12079.360906069967,12088.659743294149],[9.500000000000046,13349.707028024992,13359.983792963918],[9.600000000000048,14753.651217138953,14765.008755190624],[9.700000000000049,16305.243536808066,16317.79550927817],[9.80000000000005,18020.01164876238,18033.883670337258],[9.900000000000052,19915.116207157225,19930.44710300106],[10.000000000000053,22009.52259494326,22026.465790000006]])
